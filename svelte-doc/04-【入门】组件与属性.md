## 组件式开发

在项目开发中，我们通常推崇组件式的开发。所谓组件式，即抽离一些通用的逻辑到一个文件中组装成一个组件，当页面有用到该功能时，直接调用组件即可。那组件除了内部维持自身的逻辑之外，还需要通过接受外部传进来的数据，来实现组件的动态性和灵活性。

## 传值

举个最简单的todolist的例子，我们可以把列表展示封装成一个组件，组件的内部逻辑便是把列表数据展示出来，而对外则接收列表数据。页面引用了这个组件后，可以通过传递的是todo list还是done list来展示不同的数据。那传值在这里便是关键的一环。

当我们从父页面向子页面/组件传值时，通常传递的无非就是父页面的状态，亦或者是父页面的方法，那这两者在Svelte中该如何传递呢？

### 传递数据

在上一章的结尾处，我们遇到了如下代码：
```javascript
<script>
	export let value;
</script>
```

我们在页面中正常声明变量是`let value;`，当我们在前边添加`export`关键字时，便相当于把变量声明标记为是一个对外导出的属性，即*prop*，在外部引用该文件后，则可以通过属性赋值的形式来进行传值。
```html
<!-- Father .svelte -->
<script>
	import Child from './Child.svelte';
	let value = ''
</script>

<Child value={value} />
```

#### 默认值
当我们在组件内对外导出的形式是`export let value;`时，
```html
<script>
  export let value;
</script>

<div>child: {value || ''}</div>
```

而引用这个组件时却没有传值，
![[Pasted image 20240222140143.png]]
![[Pasted image 20240222140245.png]]

不止在VsCode中会提示我们需要传值，在Chrome控制台也会给出相应警告。

在我们开发时，往往会为某些传参提供一个默认值，因为有些组件在大部分情况下使用的是一个固定的状态，在遇到特殊情况时才会更改状态。比如在UI组件库中，类似Alert组件，有success，info，warning，error四种状态，我们在使用时大部分情况的提示都是正常的消息提示，也就是info状态，因此在组件内部便可以设置一个默认的info状态。

在为prop设置了默认值后，便可以消除我们上述演示中的告警。
在Svelte中，为prop设置默认值，只需在初始声明时进行赋值即可。
```html
<script>
	export let value = 'hello svelte';
</script>
```

#### 关键字
在JavaScript中，有一些特殊的词汇被称为关键字，它们用于编程语言的语法结构中，具有特定的含义。这些词汇不能被用作变量使用。

在Svelte中，我们在设置prop时，可以把一些关键字设置成prop。

举个非常普遍的例子，我们定义一个组件，在组件内有自己的class样式，然而我们需要组件支持在外部由用户自定义class，用户能够像`<Component class={} />`这种形式操作，而class在js中是用于定义一个类的关键字。因此，我们可以按如下写法：

```html
<script> 
  let className;
  export { className as class };
</script>
```
  
#### const

这里笔者有一个设想：export声明的变量能是一个方法吗？

```html
<!-- Child.svelte -->
<script>
  export let onChange = () => {return;}
</script>

<button on:click={onChange}>change</button>
```

```html
<script>
	import Child from './Child.svelte';
	let count = 0;
	const onChange = () => {
		count = Math.random();
	}
</script>

<Child onChange={onChange} />
<span>{count}</span>
```

答案是可以。
![[test7.gif]]

然而需要注意的是，当我们导出的是function、class和const 常量时，导出的prop是不可变的。

仍旧以上面的导出方法作为例子，将Child.svelte的内容改成如下：
```html
<script>
  export function onChange() {
    console.log('no change');
  }
</script>

<button on:click={onChange}>change</button>
```

![[test8.gif]]

因此我们要设置一个变量或方法为prop，尽量使用let或var声明。

### 方法调用


dispatch 值的获取， 展示一下源码？event.detail

  

多层嵌套时的方法转发，通过简写的形式

```

<Inner on:message/>

```

当出现属性名和值一样时 (`name={name}`)，可以简写为 `{name}`



export default只能是组件本身




解构传值

  

## `$$props`


  

[createEventDispatcher](https://www.svelte.cn/docs#createEventDispatcher)