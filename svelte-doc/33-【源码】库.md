在正式解读源码之前，笔者会和读者朋友们一起了解一些npm库的功能作用，每一个都和我们接下来的源码解读息息相关。在阅读完本章后，相信读者们在接下来的源码讲解中，不至于遇到一个功能库而一头雾水。

## acorn
如果你没有听过acorn，但有一个鼎鼎大名的库你一定听说过，那就是webpack。

js解析器
Esprima
Acorn
UglifyJS 2
Shift

Webpack/Rollup/Babel(@babel/parser) 等都有使用

https://github.com/acornjs/acorn/tree/master/acorn

抽象语法树也有一套约定的规范 https://github.com/estree/estree?tab=readme-ov-file
https://web.archive.org/web/20210314002546/https://developer.mozilla.org/en-US/docs/Mozilla/Projects/SpiderMonkey/Parser_API

acorn.js parse 返回值符合 ESTree spec 描述的 AST 对象



### 词法分析
Tokenization
词法分析是由词法分析器完成的,词法分析器会扫描(scanning)代码,提取词法单元
源代码分解成一个个词素

词法分析，也称之为扫描（scanner），简单来说就是调用 next() 方法，一个一个字母的来读取字符，然后与定义好的 JavaScript 关键字符做比较，生成对应的Token。Token 是一个不可分割的最小单元

整个代码将被分割进一个tokens列表


### 语法分析
将词法分析阶段生成的 Token 转换为抽象语法树(Abstract Syntax Tree),这一过程称之为语法解析(Parsing)。

https://astexplorer.net/

Program
根节点,即代表一整颗抽象语法树,body 属性是一个数组,包含了多个 Statement 节点

ExpressionStatement
表达式语句节点,expression 属性指向一个表达式节点对象

BinaryExpression
二元运算表达式节点,left 和 right 表示运算符左右的两个表达式,operator 表示一个二元运算符

Literal
字面量

VariableDeclaration
变量声明

VariableDeclarator
变量声明的描述

Identifier
标识符节点

工具 Babel

@babel/parser : 将 js 代码 ------->>>  AST 抽象语法树；
@babel/traverse 对 AST 节点进行递归遍历；
@babel/types 对具体的 AST 节点进行进行修改；
@babel/generator :  AST 抽象语法树 ------->>> 新的 js 代码；

### acorn
ecmaVersion字面意义，很好理解，就是设置你要解析的 JavaScript 的 ECMA 版本。默认是 ES7。
sourceType这个配置项有两个值：module 和 script，默认是 script。主要是严格模式和 import/export 的区别。ES6 中的模块是严格模式，也就是你无须添加 use strict。我们通常浏览器中使用的 script 是没有 import/export 语法的。所以，选择了 script 则出现 import/export 会报错，可以使用严格模式声明，选择了 module，则不用严格模式声明，可以使用 import/export 语法。
locations默认值是 false，设置为 true 之后会在 AST 的节点中携带多一个 loc 对象来表示当前的开始和结束的行数和列数。
onComment传入一个回调函数，每当解析到代码中的注释时会触发，可以获取当年注释内容，参数列表是：

todo 重写

## periscopic
https://github.com/Rich-Harris/periscopic#readme
从ast对象中分析处变量作用域

extract_identifiers and extract_names

## estree-walker
https://github.com/Rich-Harris/estree-walker#readme

Inside the enter function, calling this.skip() will prevent the node's children being walked, or the leave function (which is optional) being called.

Call this.replace(new_node) in either enter or leave to replace the current node with a new one.

Call this.remove() in either enter or leave to remove the current node.

相同作用的包estraverse

acorn-walk

## escodegen
https://github.com/estools/escodegen
用于把满足 Estree 标准的 AST 转换为 ESMAScript 代码

## 小结