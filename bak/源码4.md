compiler

编译器将svelte文件内容编译成能被浏览器执行的js代码，大概内容如下

```

function create_fragment() {
  return {
    c,
    m,
    d,
    ......
  }
}

class App extends SvelteComponent{
  constructor() {
    init(this, options, null, create_fragment);
  }
}
```

runtime

所以我们在运行时需要了解的主要功能，就是init方法和create_fragment方法.

关注init的第三个参数和第四个参数：第三个参数instance，在这里是一些生命周期和数据更新的操作，create_fragment是生成页面dom内容的操作。

## SvelteComponent

里面最为重要的属性是 `$$`，组件的状态都挂载在这个属性里

## init

```
function init(
	component,
	options,
	instance,
	create_fragment,
	not_equal,
	props,
	append_styles = null,
	dirty = [-1]
)
```

init的关键步骤：

* 记录当前组件
* 为component的 `$$`属性挂载状态
  * fragment：当前组件生成的dom
  * ctx：一个数组，instance方法执行后返回的数组
  * props
  * update
  * not_equal
  * bound
  * on_mount：生命周期
  * on_destroy：生命周期
  * on_disconnect
  * before_update
  * after_update
  * context：context
  * callbacks: 方法
  * dirty
  * skip_bound
  * root：挂载节点
* 挂载样式
* 先执行before_update生命周期方法
* 执行create_fragment方法，创建dom内容，并挂在到fragment
* 执行fragment对象里的c函数，即create方法，创建dom元素
* 执行mount
  * 执行fragment对象里的m函数，即mount，把dom元素挂载到页面上
  * 把on_mount上的方法加入到on_destory数组队列，同时清空on_mount数组
  * 执行after_update回调
* 执行flush，flush主要的更新函数
