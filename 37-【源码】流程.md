TODO: 直接使用svelte源码来编译自定义的App.svelte，查看具体的编译流程，及各个节点的数据内容

## compile阶段

TODO 流程图

路径：packages/svelte/src/compiler/compile/index.js

```
export default function compile(source, options = {}) {
  const ast = parse(source, options);
  const component = new Component(
		ast,
		source,
		options.name || get_name_from_filename(options.filename) || 'Component',
		options,
		stats,
		warnings
	);
  const result = render_dom(component, options);
  return component.generate(result);
}
```

### parse方法

路径：packages/svelte/src/compiler/parse/index.js

```
export default function parse(template, options = {}) {
	const parser = new Parser(template, options);
  return {
		html: parser.html,
		css: parser.css[0],
		instance: instance_scripts[0],
		module: module_scripts[0]
	};
}
```

#### Parser

### Component

路径：packages/svelte/src/compiler/compile/Component.js

```
this.walk_module_js();
this.walk_instance_js_pre_template();
this.fragment = new Fragment(this, ast.html);
this.walk_instance_js_post_template();
```

this.vars记录变量
walk_module_js找出在script context='module'中的变量

### render_dom

路径：packages/svelte/src/compiler/compile/render_dom/index.js

```
export default function dom(component, options) {
  const renderer = new Renderer(component, options);
}
```

#### Renderer

调用component中的generate方法

## runtime

![[Pasted image 20240327173206.png]]


## 小结